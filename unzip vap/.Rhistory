---
title: "Untitled"
## R Markdown
This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.
```{r setup, include=FALSE}
library(terra)
library(leaflet)
library(raster)
library(sf)
library(htmlwidgets)
# Set working directory
setwd("C:/Users/chake/Downloads/unzip wind/")
# Read all . tif files (your wind speed data)
r <- rast(list.files(pattern = "\\.tif$", full.names = TRUE, ignore.case = TRUE))
print(paste("Loaded", nlyr(r), "raster layers"))
# Calculate annual mean
annual_mean <- mean(r, na. rm = TRUE)
library(terra)
library(leaflet)
library(raster)
library(sf)
library(htmlwidgets)
# Set working directory
setwd("C:/Users/chake/Downloads/unzip wind/")
# Read all . tif files (your wind speed data)
r <- rast(list.files(pattern = "\\.tif$", full.names = TRUE, ignore.case = TRUE))
print(paste("Loaded", nlyr(r), "raster layers"))
# Calculate annual mean
annual_mean <- mean(r, na.rm = TRUE)
annual_raster <- raster(annual_mean)
# ============================================================================
# CREATE A SIMPLE GRID OF CELLS (no country download needed)
# ============================================================================
# Get the extent of your raster
ext_r <- ext(annual_mean)
# Create a grid - divide the world into cells
n_rows <- 18  # number of latitude bands
n_cols <- 36  # number of longitude bands
# Calculate cell size
cell_width <- (ext_r[2] - ext_r[1]) / n_cols
cell_height <- (ext_r[4] - ext_r[3]) / n_rows
# Create grid cells
grid_cells <- list()
cell_id <- 1
for(i in 1:n_rows) {
for(j in 1:n_cols) {
# Calculate cell boundaries
xmin <- ext_r[1] + (j-1) * cell_width
xmax <- xmin + cell_width
ymin <- ext_r[3] + (i-1) * cell_height
ymax <- ymin + cell_height
# Create polygon
coords <- matrix(c(
xmin, ymin,
xmax, ymin,
xmax, ymax,
xmin, ymax,
xmin, ymin
), ncol = 2, byrow = TRUE)
poly <- st_polygon(list(coords))
grid_cells[[cell_id]] <- poly
cell_id <- cell_id + 1
}
}
# Convert to sf object
grid_sf <- st_sf(
cell_id = 1:length(grid_cells),
geometry = st_sfc(grid_cells, crs = crs(annual_mean))
)
print(paste("Created", nrow(grid_sf), "grid cells"))
# ============================================================================
# CALCULATE WIND SPEED FOR EACH CELL
# ============================================================================
grid_sf$wind_mean <- NA
grid_sf$wind_percent <- NA
grid_sf$lat_center <- NA
grid_sf$lon_center <- NA
# Calculate global maximum for percentage
global_max <- global(annual_mean, "max", na.rm = TRUE)$max
print("Processing grid cells...  Please wait...")
for(i in 1:nrow(grid_sf)) {
cell_poly <- vect(grid_sf[i, ])
tryCatch({
# Crop and mask to cell
cropped <- crop(annual_mean, cell_poly)
masked <- mask(cropped, cell_poly)
# Calculate mean
cell_mean <- global(masked, "mean", na.rm = TRUE)$mean
grid_sf$wind_mean[i] <- round(cell_mean, 2)
grid_sf$wind_percent[i] <- round((cell_mean / global_max) * 100, 2)
# Get center coordinates
centroid <- st_centroid(grid_sf[i, ])
coords <- st_coordinates(centroid)
grid_sf$lat_center[i] <- round(coords[2], 1)
grid_sf$lon_center[i] <- round(coords[1], 1)
}, error = function(e) {
grid_sf$wind_mean[i] <- NA
grid_sf$wind_percent[i] <- NA
})
# Progress indicator
if(i %% 100 == 0) {
print(paste("Processed", i, "of", nrow(grid_sf), "cells"))
}
}
print("âœ… Processing complete!")
# Remove cells with no data
grid_clean <- grid_sf[! is.na(grid_sf$wind_mean), ]
# ============================================================================
# CREATE COLOR PALETTES
# ============================================================================
# Color palette for grid cells (blue gradient for wind)
pal_grid <- colorNumeric(
palette = "Blues",
domain = grid_clean$wind_mean,
na.color = "transparent"
)
# Color palette for raster
pal_raster <- colorNumeric(
palette = "Blues",
domain = values(annual_raster),
na. color = "transparent"
library(terra)
library(leaflet)
library(raster)
library(sf)
library(htmlwidgets)
# Set working directory
setwd("C:/Users/chake/Downloads/unzip wind/")
# Read all . tif files (your wind speed data)
r <- rast(list.files(pattern = "\\.tif$", full.names = TRUE, ignore.case = TRUE))
print(paste("Loaded", nlyr(r), "raster layers"))
# Calculate annual mean
annual_mean <- mean(r, na.rm = TRUE)
annual_raster <- raster(annual_mean)
# ============================================================================
# CREATE A SIMPLE GRID OF CELLS (no country download needed)
# ============================================================================
# Get the extent of your raster
ext_r <- ext(annual_mean)
# Create a grid - divide the world into cells
n_rows <- 18  # number of latitude bands
n_cols <- 36  # number of longitude bands
# Calculate cell size
cell_width <- (ext_r[2] - ext_r[1]) / n_cols
cell_height <- (ext_r[4] - ext_r[3]) / n_rows
# Create grid cells
grid_cells <- list()
cell_id <- 1
for(i in 1:n_rows) {
for(j in 1:n_cols) {
# Calculate cell boundaries
xmin <- ext_r[1] + (j-1) * cell_width
xmax <- xmin + cell_width
ymin <- ext_r[3] + (i-1) * cell_height
ymax <- ymin + cell_height
# Create polygon
coords <- matrix(c(
xmin, ymin,
xmax, ymin,
xmax, ymax,
xmin, ymax,
xmin, ymin
), ncol = 2, byrow = TRUE)
poly <- st_polygon(list(coords))
grid_cells[[cell_id]] <- poly
cell_id <- cell_id + 1
}
}
# Convert to sf object
grid_sf <- st_sf(
cell_id = 1:length(grid_cells),
geometry = st_sfc(grid_cells, crs = crs(annual_mean))
)
print(paste("Created", nrow(grid_sf), "grid cells"))
# ============================================================================
# CALCULATE WIND SPEED FOR EACH CELL
# ============================================================================
grid_sf$wind_mean <- NA
grid_sf$wind_percent <- NA
grid_sf$lat_center <- NA
grid_sf$lon_center <- NA
# Calculate global maximum for percentage
global_max <- global(annual_mean, "max", na.rm = TRUE)$max
print("Processing grid cells...  Please wait...")
for(i in 1:nrow(grid_sf)) {
cell_poly <- vect(grid_sf[i, ])
tryCatch({
# Crop and mask to cell
cropped <- crop(annual_mean, cell_poly)
masked <- mask(cropped, cell_poly)
# Calculate mean
cell_mean <- global(masked, "mean", na.rm = TRUE)$mean
grid_sf$wind_mean[i] <- round(cell_mean, 2)
grid_sf$wind_percent[i] <- round((cell_mean / global_max) * 100, 2)
# Get center coordinates
centroid <- st_centroid(grid_sf[i, ])
coords <- st_coordinates(centroid)
grid_sf$lat_center[i] <- round(coords[2], 1)
grid_sf$lon_center[i] <- round(coords[1], 1)
}, error = function(e) {
grid_sf$wind_mean[i] <- NA
grid_sf$wind_percent[i] <- NA
})
# Progress indicator
if(i %% 100 == 0) {
print(paste("Processed", i, "of", nrow(grid_sf), "cells"))
}
}
print("âœ… Processing complete!")
# Remove cells with no data
grid_clean <- grid_sf[! is.na(grid_sf$wind_mean), ]
# ============================================================================
# CREATE COLOR PALETTES
# ============================================================================
# Color palette for grid cells (blue gradient for wind)
pal_grid <- colorNumeric(
palette = "Blues",
domain = grid_clean$wind_mean,
na.color = "transparent"
)
# Color palette for raster
pal_raster <- colorNumeric(
palette = "Blues",
domain = values(annual_raster),
na.color = "transparent"
)
# ============================================================================
# CREATE INTERACTIVE MAP - HOVER TO SEE VALUES
# ============================================================================
interactive_map <- leaflet(grid_clean) %>%
# Add base maps
addProviderTiles(providers$CartoDB.Positron, group = "Light Map") %>%
addProviderTiles(providers$Esri.WorldImagery, group = "Satellite") %>%
addProviderTiles(providers$OpenStreetMap, group = "Street Map") %>%
# Add the wind speed raster
addRasterImage(annual_raster,
colors = pal_raster,
opacity = 0.7,
group = "Wind Speed") %>%
# Add grid cells with HOVER labels
addPolygons(
fillColor = ~pal_grid(wind_mean),
fillOpacity = 0.6,
color = "#FFFFFF",
weight = 1,
opacity = 0.8,
# â­ HOVER LABEL - Shows location and wind speed
label = ~paste0(
"ðŸ“ Location: ", lat_center, "Â°N, ", lon_center, "Â°E",
"\nðŸ’¨ Wind Speed: ", wind_mean, " m/s",
"\nðŸ“Š Percentage: ", wind_percent, "% of maximum"
),
labelOptions = labelOptions(
style = list(
"font-weight" = "bold",
"font-size" = "14px",
"padding" = "10px",
"background-color" = "rgba(255, 255, 255, 0.95)",
"border" = "3px solid #4facfe",
"border-radius" = "8px",
"box-shadow" = "0 0 15px rgba(79, 172, 254, 0.6)",
"white-space" = "pre-line"
),
textsize = "14px",
direction = "auto",
sticky = TRUE,
opacity = 1
),
# Highlight effect when hovering
highlightOptions = highlightOptions(
weight = 3,
color = "#0000FF",
fillOpacity = 0.9,
bringToFront = TRUE
),
group = "Grid Cells"
) %>%
# Add legend
addLegend(
pal = pal_grid,
values = ~wind_mean,
title = "Wind Speed<br/>(m/s)",
position = "bottomright",
opacity = 1
) %>%
# Layer control
addLayersControl(
baseGroups = c("Light Map", "Satellite", "Street Map"),
overlayGroups = c("Wind Speed", "Grid Cells"),
options = layersControlOptions(collapsed = FALSE)
) %>%
# Add scale bar
addScaleBar(position = "bottomleft") %>%
# Set initial view
setView(lng = 10, lat = 20, zoom = 2)
# Display the map
interactive_map
# Save the interactive map as HTML
saveWidget(interactive_map,
file = "wind_speed_interactive_grid.html",
selfcontained = TRUE)
# ============================================================================
# COMPUTE MONTHLY MEAN FOR PLOTTING
# ============================================================================
monthly_mean_wind <- global(r, fun = "mean", na.rm = TRUE)
# Plot the annual cycle (monthly means)
months <- month.abb[1:nrow(monthly_mean_wind)]
plot(1:length(months), monthly_mean_wind$mean, type = "l",
xaxt = "n", xlab = "Month", ylab = "Mean wind speed (m/s)",
main = "Monthly Mean Wind Speed at 10 m",
col = "#4facfe", lwd = 3)
axis(1, at = 1:length(months), labels = months)
points(1:length(months), monthly_mean_wind$mean, pch = 19, col = "#00f2fe", cex = 1.5)
grid(col = "gray80")
# ============================================================================
# PRINT SUMMARY
# ============================================================================
cat("\n")
cat("========================================\n")
cat("âœ… INTERACTIVE MAP CREATED SUCCESSFULLY!\n")
cat("========================================\n\n")
cat("ðŸ–±ï¸  HOW TO USE:\n")
cat("   â€¢ Hover over any cell to see:\n")
cat("     - Location coordinates\n")
cat("     - Wind speed value (m/s)\n")
cat("     - Percentage of maximum\n\n")
cat("   â€¢ Use mouse wheel to ZOOM in/out\n")
cat("   â€¢ Click and drag to PAN\n")
cat("   â€¢ Switch between map styles in top-right\n\n")
cat("ðŸ“ FILE CREATED:\n")
cat("   â€¢ wind_speed_interactive_grid. html\n")
cat("     (Open this in any web browser! )\n\n")
# ============================================================================
# CREATE DATA TABLE
# ============================================================================
grid_summary <- data.frame(
Cell_ID = grid_clean$cell_id,
Latitude = grid_clean$lat_center,
Longitude = grid_clean$lon_center,
Wind_Speed = grid_clean$wind_mean,
Percent_of_Max = grid_clean$wind_percent
)
# Sort by wind speed (highest first)
grid_summary <- grid_summary[order(-grid_summary$Wind_Speed), ]
# Print top 20
cat("========================================\n")
cat("TOP 20 HIGHEST WIND SPEED AREAS:\n")
cat("========================================\n")
print(head(grid_summary, 20), row.names = FALSE)
# Save to CSV
write.csv(grid_summary,
"wind_speed_grid_summary.csv",
row.names = FALSE)
cat("\nðŸ“Š Full data saved to:\n")
cat("   â€¢ wind_speed_grid_summary.csv\n")
cat("========================================\n")
# Print numeric monthly means to the console
cat("\n========================================\n")
cat("MONTHLY WIND SPEED MEANS:\n")
cat("========================================\n")
print(data.frame(Month = months, Mean_m_s = monthly_mean_wind$mean))
# ============================================================================
# BONUS: Create simple static plots
# ============================================================================
# Plot the grid with wind speed
plot(st_geometry(grid_clean),
col = pal_grid(grid_clean$wind_mean),
border = "white",
lwd = 0.5,
main = "Wind Speed by Grid Cell")
# Add legend manually
legend_values <- seq(min(grid_clean$wind_mean, na.rm = TRUE),
max(grid_clean$wind_mean, na.rm = TRUE),
length.out = 5)
legend("bottomleft",
legend = round(legend_values, 2),
fill = pal_grid(legend_values),
title = "m/s",
bty = "n")
shiny::runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
runApp('C:/Users/chake/OneDrive/Images/R programs/myapp')
